# Release Notes for PartsHub v0.3.0

**Release Date**: October 5, 2025
**GitHub Release**: [v0.3.0](https://github.com/madeinoz67/partshub/releases/tag/v0.3.0)
**Comparison**: [v0.2.1...v0.3.0](https://github.com/madeinoz67/partshub/compare/v0.2.1...v0.3.0)

## Overview

PartsHub v0.3.0 introduces a comprehensive inline stock management system that revolutionizes how you track and manage component inventory. This major feature release adds five new stock operations directly accessible from the component list, complete with transaction history, multi-format export capabilities, and automatic location tracking.

## New Features

### üéØ Inline Stock Operations

Manage component inventory directly from the component list with a streamlined row-expansion interface. All stock operations are now accessible from a single, intuitive menu without navigating away from the component list.

**Available Operations**:

- **Add Stock**: Add inventory to any storage location with optional lot and pricing information
- **Remove Stock**: Safely remove inventory with auto-capping validation and zero-quantity cleanup
- **Move Stock**: Transfer stock between locations with atomic operations and pricing inheritance
- **View History**: Access paginated transaction history (10 entries/page) with complete audit trail
- **Export History**: Download transaction history in CSV, Excel, or JSON formats (admin-only)

**Key Features**:

- ‚úÖ **Pessimistic Locking**: Row-level database locks prevent race conditions
- ‚úÖ **Atomic Transactions**: All-or-nothing execution ensures data consistency
- ‚úÖ **Auto-Capping**: Remove operations automatically cap at available quantity
- ‚úÖ **Zero Cleanup**: Automatic deletion of `ComponentLocation` records when quantity reaches 0
- ‚úÖ **Pricing Tracking**: Track `lot_id`, `price_per_unit`, and `total_price` for all transactions
- ‚úÖ **Location Tracking**: Auto-update `last_used_at` timestamp on storage locations
- ‚úÖ **Tiered Access**: Admin-only for destructive operations (remove, move, export)

### üìä Stock Transaction History

**Paginated History Table**:
- Server-side pagination (10 entries per page, configurable)
- Color-coded transaction types (green for additions, red for removals, blue for moves)
- Complete transaction details (timestamp, type, quantity, location, lot, pricing)
- Real-time updates after stock operations
- Sort by any column

**Multi-Format Export** (Admin-only):
- **CSV**: Comma-separated values for spreadsheet applications
- **Excel**: Native .xlsx format with formatted headers
- **JSON**: Structured data for programmatic access
- Streaming responses for large datasets
- Unicode-safe filename handling

### üóÑÔ∏è Database Enhancements

**Extended Stock Transactions Model**:
```sql
ALTER TABLE stock_transactions ADD COLUMN lot_id VARCHAR(100);
ALTER TABLE stock_transactions ADD COLUMN price_per_unit DECIMAL(10, 2);
ALTER TABLE stock_transactions ADD COLUMN total_price DECIMAL(10, 2);
```

**Storage Location Tracking**:
```sql
ALTER TABLE storage_locations ADD COLUMN last_used_at TIMESTAMP;
```

All stock movements (add/remove/move) automatically update the `last_used_at` timestamp, enabling you to identify frequently used or stale storage locations.

## API Changes

### New Endpoints

**Stock Operations**:
- `POST /api/v1/components/{id}/stock/add` - Add stock to a location
- `POST /api/v1/components/{id}/stock/remove` - Remove stock from a location
- `POST /api/v1/components/{id}/stock/move` - Move stock between locations

**Stock History**:
- `GET /api/v1/components/{id}/stock/history` - Get paginated transaction history
- `GET /api/v1/components/{id}/stock/history/export` - Export history (CSV/Excel/JSON)

All endpoints are fully documented with OpenAPI contracts. See [Stock Operations API Reference](../api/stock-operations.md) for complete details.

### Request/Response Examples

**Add Stock**:
```bash
curl -X POST http://localhost:8000/api/v1/components/{id}/stock/add \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "location_id": "storage-uuid",
    "quantity": 100,
    "lot_id": "LOT-2025-001",
    "price_per_unit": 0.25,
    "notes": "Received from supplier XYZ"
  }'
```

**Export History**:
```bash
curl -X GET "http://localhost:8000/api/v1/components/{id}/stock/history/export?format=excel" \
  -H "Authorization: Bearer <admin-token>" \
  -o component_history.xlsx
```

## Frontend Improvements

### New Vue Components

- **AddStockForm.vue**: Add stock with lot/pricing inputs and location selection
- **RemoveStockForm.vue**: Remove stock with auto-capping and quantity validation
- **MoveStockForm.vue**: Move between locations with pricing inheritance options
- **StockHistoryTable.vue**: Paginated history with export controls

### Integration

Stock operations are fully integrated into `ComponentList.vue`:
- Access via row expansion menu (click arrow on left side of component row)
- Operations appear as dialog forms over the component list
- History auto-refreshes after each operation
- Real-time feedback with optimistic UI updates

## Documentation

### New Documentation Pages

- **[Stock Operations API Reference](../api/stock-operations.md)**: Complete API documentation with schemas and examples
- **[Stock Operations User Guide](../user/stock-operations.md)**: Step-by-step workflows and troubleshooting

### Updated Documentation

- **[API Documentation](../api.md)**: Added stock operations overview
- **[User Features Guide](../user/features.md)**: Added stock management section
- **CLAUDE.md**: Updated with stock operations patterns

## Testing

### Comprehensive Test Coverage

**Backend**: 917 tests passing ‚úÖ
- 32 contract tests (OpenAPI validation)
- 18 integration tests (user story scenarios)
- 20 unit tests (locking, service logic)
- Coverage: 80%+

**Frontend**: 319 tests passing ‚úÖ
- 52 AddStockForm component tests
- 67 MoveStockForm component tests
- 48 StockHistoryTable component tests
- All scenarios with auto-refresh validation

**Total**: 1,236 tests passing across backend and frontend

### CI/CD Pipeline

All quality gates passing:
- ‚úÖ Ruff linting (zero errors)
- ‚úÖ Type checking (frontend and backend)
- ‚úÖ All unit and integration tests
- ‚úÖ Security scans
- ‚úÖ Docker build validation

## Performance

- **Stock Operations**: <200ms response time for standard transactions
- **History Pagination**: Efficient server-side pagination with 10 entries/page
- **Export**: Streaming responses for large datasets (no memory issues)
- **Locking**: Minimal lock duration (transaction scope only, typically <50ms)

## Security

### Access Control

- **Read History**: All authenticated users can view stock history
- **Add Stock**: All authenticated users can add inventory
- **Remove Stock**: Admin-only (destructive operation)
- **Move Stock**: Admin-only (destructive operation)
- **Export History**: Admin-only (data export)

### Transaction Safety

- **Pessimistic Locking**: Database row locks prevent concurrent modification
- **Atomic Operations**: All operations execute atomically or roll back completely
- **Validation**: Auto-capping prevents removing more than available quantity
- **Audit Trail**: Complete transaction history for compliance and debugging

## Breaking Changes

**None** - All changes are additive. Existing functionality remains unchanged.

## Migration Instructions

### Database Migration Required

Run Alembic migrations to add new columns:

```bash
cd backend
uv run alembic upgrade head
```

This adds:
- `stock_transactions.lot_id` (nullable VARCHAR)
- `stock_transactions.price_per_unit` (nullable DECIMAL)
- `stock_transactions.total_price` (nullable DECIMAL)
- `storage_locations.last_used_at` (nullable TIMESTAMP)

### No Code Changes Required

All new features are opt-in. Existing stock management workflows continue to work:
- Legacy stock updates still function
- No changes to existing API endpoints
- Frontend remains backward compatible

## Installation & Upgrade

### Fresh Installation

```bash
# Clone repository
git clone https://github.com/madeinoz67/partshub.git
cd partshub

# Install dependencies
make install

# Run migrations
cd backend && uv run alembic upgrade head

# Start development servers
make dev
```

### Upgrading from v0.2.1

```bash
# Pull latest changes
git pull origin main

# Update dependencies
make install

# Run database migrations
cd backend && uv run alembic upgrade head

# Restart services
make dev
```

## Files Changed

**87 files changed** with significant additions to backend services, frontend components, and documentation.

### Backend Files Added/Modified

- `backend/src/api/stock_history.py` (new)
- `backend/src/services/stock_operations.py` (new)
- `backend/src/services/stock_history_service.py` (new)
- `backend/src/schemas/stock_operations.py` (new)
- `backend/migrations/versions/20251004_*.py` (new migrations)

### Frontend Files Added/Modified

- `frontend/src/components/stock/AddStockForm.vue` (new)
- `frontend/src/components/stock/RemoveStockForm.vue` (new)
- `frontend/src/components/stock/MoveStockForm.vue` (new)
- `frontend/src/components/stock/StockHistoryTable.vue` (new)
- `frontend/src/services/stockOperations.ts` (modified)
- `frontend/src/components/ComponentList.vue` (modified)

### Documentation Files Added

- `docs/api/stock-operations.md`
- `docs/user/stock-operations.md`
- `specs/006-add-remove-stock/contracts/*.yaml`

## Constitutional Compliance

This release follows all 7 project constitution principles:

- **Principle I (API-First)**: Complete OpenAPI contracts before implementation ‚úÖ
- **Principle II (TDD)**: All tests written before implementation (RED-GREEN-REFACTOR) ‚úÖ
- **Principle III (Tiered Access)**: Admin-only for destructive operations ‚úÖ
- **Principle IV (Quality Gates)**: All tests passing, linting clean, CI green ‚úÖ
- **Principle V (Anonymous Contribution)**: Standard commit format, no tool attribution ‚úÖ
- **Principle VI (Test Isolation)**: In-memory SQLite, no production DB access ‚úÖ
- **Principle VII (Documentation)**: Comprehensive API/user docs with examples ‚úÖ

## Known Issues

None at this time. All tests passing and CI pipeline green.

## What's Next (v0.4.0 Preview)

### Planned Features

- **Stock Alerts**: Configurable low-stock notifications
- **Batch Stock Operations**: Update stock for multiple components simultaneously
- **Stock Reconciliation**: Compare physical counts with database records
- **Location Suggestions**: AI-powered recommendations for stock placement
- **Import/Export**: Bulk import stock data from CSV/Excel files

### Community Requested

- Real-time stock updates via WebSocket
- Mobile barcode scanning for stock operations
- Advanced reporting dashboard with charts and analytics
- Integration with external inventory systems

## Support & Feedback

- **Issues**: [GitHub Issues](https://github.com/madeinoz67/partshub/issues)
- **Discussions**: [GitHub Discussions](https://github.com/madeinoz67/partshub/discussions)
- **Documentation**: [User Guide](../user/stock-operations.md) | [API Reference](../api/stock-operations.md)

---

**Full Changelog**: https://github.com/madeinoz67/partshub/blob/main/CHANGELOG.md
