# Release Notes for PartsHub v0.3.1

**Release Date**: October 5, 2025
**GitHub Release**: [v0.3.1](https://github.com/madeinoz67/partshub/releases/tag/v0.3.1)
**Comparison**: [v0.3.0...v0.3.1](https://github.com/madeinoz67/partshub/compare/v0.3.0...v0.3.1)

## Overview

PartsHub v0.3.1 is a patch release that fixes critical build issues in the release workflow and resolves all npm security vulnerabilities in frontend dependencies. This release ensures reliable automated releases and a secure frontend build environment.

## Bug Fixes

### 1. Release Workflow Build Failure

**Fixed frontend build failure due to Node.js version mismatch**

The v0.3.0 release workflow failed with the error `crypto.hash is not a function` because the release workflow was using Node.js 18 while the codebase requires Node.js 20+.

**Root Cause**:
- Release workflow used Node.js 18
- CI workflow uses Node.js 20
- `@vitejs/plugin-vue v6.0.1` (bundled in Quasar) uses `crypto.hash()` API
- `crypto.hash()` was added in Node.js 20.12.0 (March 2024)

**Changes**:
- Updated `.github/workflows/release.yml` to use Node.js 20
- Updated `frontend/package.json` engines to require Node.js >=20.0.0
- Updated npm requirement to >=10.0.0

**Impact**: Release workflow now succeeds and builds all artifacts correctly.

### 2. NPM Security Vulnerabilities

**Resolved 8 moderate severity vulnerabilities in frontend dependencies**

All npm audit vulnerabilities have been fixed by updating frontend dev dependencies to their latest secure versions.

**Vulnerabilities Fixed**:

1. **esbuild <=0.24.2** (GHSA-67mh-4wv8-2f99)
   - Severity: Moderate
   - Issue: Development server exploit vulnerability
   - Impact: Dev environment only
   - Fix: Updated via vite dependency

2. **vue-template-compiler >=2.0.0** (GHSA-g3ch-rx76-35fx)
   - Severity: Moderate
   - Issue: Client-side XSS vulnerability
   - Impact: Dev dependency only (vue-tsc)
   - Fix: Updated via vue-tsc dependency

**Package Updates** (SemVer major, dev dependencies only):
- `@vitejs/plugin-vue`: 4.6.2 â†’ 6.0.1
- `vitest`: 0.34.6 â†’ 3.2.4
- `vue-tsc`: 1.8.22 â†’ 3.1.0

**Verification**:
```bash
npm audit          # Shows 0 vulnerabilities âœ…
npm test          # All 319 tests passing âœ…
npm run build     # Build succeeds âœ…
```

## Security Analysis

### Investigation Summary

The `crypto.hash is not a function` error initially raised concerns about potential malicious packages. A comprehensive security review was conducted:

**Findings**:
- âœ… **No malicious packages detected**
- âœ… **All dependencies from official npm registry**
- âœ… **crypto.hash() usage is legitimate** - Official Node.js 20+ API
- âœ… **All crypto operations use Node.js core module** (`node:crypto`)
- âœ… **No supply chain attack indicators**

**Details**:
- `crypto.hash()` is used by `@vitejs/plugin-vue v6.0.1` for generating Vue component descriptor IDs
- This is a convenience method added to Node.js core in v20.12.0
- Replaces older pattern: `crypto.createHash("sha256").update(text).digest("hex")`
- Bundled in Quasar's `@quasar/app-vite` package dependency

## Technical Details

### Node.js Version Compatibility

**Before**: Release workflow failed with:
```
[vite:vue] crypto.hash is not a function
file: /home/runner/work/partshub/partshub/frontend/src/App.vue
    at getHash (file:///.../node_modules/@vitejs/plugin-vue/dist/index.js:140:16)
```

**After**: Release workflow succeeds with Node.js 20:
```yaml
# .github/workflows/release.yml
- name: Set up Node.js
  uses: actions/setup-node@v4
  with:
    node-version: "20"  # Updated from "18"
```

### Frontend Security Posture

**npm audit results**:
- Before: 8 moderate vulnerabilities
- After: 0 vulnerabilities âœ…

**Test coverage**:
- All 319 frontend tests passing
- No breaking changes to production code
- Frontend builds successfully

## Breaking Changes

**None** - This is a patch release with no breaking changes to APIs or functionality.

## Migration Instructions

### For Users

No migration required. Simply update to v0.3.1:

```bash
git pull origin main
```

### For Developers

**Node.js Requirement Updated**:

If you're developing locally, ensure you're using Node.js 20+:

```bash
# Check Node.js version
node --version  # Should show v20.x.x or higher

# If using nvm
nvm install 20
nvm use 20

# Install dependencies
npm install
```

**No other changes required** - all updates are in CI/CD workflows and dev dependencies.

## Installation & Upgrade

### Fresh Installation

```bash
# Clone repository
git clone https://github.com/madeinoz67/partshub.git
cd partshub

# Check Node.js version
node --version  # Must be v20.x.x or higher

# Install dependencies
make install

# Run migrations
cd backend && uv run alembic upgrade head

# Start development servers
make dev
```

### Upgrading from v0.3.0

```bash
# Pull latest changes
git pull origin main

# Update dependencies (optional - only if developing)
cd frontend && npm install

# No other steps required - all fixes are in workflows
```

## Files Changed

**3 files changed**: 5 insertions(+), 3 deletions(-)

**Modified files**:
- `.github/workflows/release.yml` - Updated Node.js version to 20
- `frontend/package.json` - Updated engines requirements and dependencies
- `frontend/package-lock.json` - Updated dependency lock file

## Verification

### Release Workflow
The release workflow now completes successfully:
```bash
âœ… Validate Release Prerequisites
âœ… Build Release Artifacts
  âœ… Backend artifact created
  âœ… Frontend artifact created
  âœ… Source archive created
  âœ… Checksums generated
âœ… Build Docker Image
âœ… Deploy Documentation
âœ… Create GitHub Release
```

### Frontend Security
```bash
npm audit
# found 0 vulnerabilities âœ…
```

### Test Suite
```bash
npm test
# Test Files  16 passed (16)
#      Tests  319 passed (319) âœ…
```

## What's Included from v0.3.0

This release includes all features from v0.3.0:

### ðŸŽ¯ Inline Stock Operations
- Add/Remove/Move stock operations
- Paginated transaction history (10 entries/page)
- Multi-format export (CSV/Excel/JSON)
- Automatic location tracking with `last_used_at`
- Complete audit trail with lot and pricing information

### ðŸ“Š Stock Transaction History
- Server-side pagination
- Color-coded transaction types
- Real-time updates after operations
- Admin-only export functionality

See [v0.3.0 release notes](v0.3.0.md) for complete feature details.

## Known Issues

**TypeScript Strict Type Checking**:
- vue-tsc v3.1.0 has stricter type checking than v1.x
- Produces ~50 type errors in test files
- Does NOT affect:
  - Runtime behavior âœ…
  - Test execution âœ…
  - Production builds âœ…

These are cosmetic errors related to test type assertions and can be addressed in future maintenance work.

## Support & Feedback

- **Issues**: [GitHub Issues](https://github.com/madeinoz67/partshub/issues)
- **Discussions**: [GitHub Discussions](https://github.com/madeinoz67/partshub/discussions)
- **Documentation**: [User Guide](../user/stock-operations.md) | [API Reference](../api/stock-operations.md)

---

**Full Changelog**: https://github.com/madeinoz67/partshub/blob/main/CHANGELOG.md
